<!DOCTYPE html>
<meta charset="utf-8">
<style>
	body {
		font: 12px sans-serif;
	}

	#header {
		margin-bottom: 20px;
	}

	.chart rect {
		fill: steelblue;
	}

	.chart text {
		fill: white;
		font: 10px;
		text-anchor: start;
	}

	.chart {
		margin-bottom: 10px;
	}

</style>
<html>
<title>Tally ho!</title>
<body>
	<div id="header">
		<h1>Zumic Rapper Personality Quiz Statistics</h1>
		<div>Data collection from a quiz I wrote and implemented for Zumic. Take the quiz <a href="http://zumic.com/rapper-personality-quiz/" target="_blank">here</a>!</div>
	</div>
	<svg class="chart"></svg>
	<div id="results"></div>
<script src="lib/jquery-1.10.2.min.js"></script>
<script src="lib/d3.v3.min.js"></script>
<script>
	//Tally ho!
	function tally() {
		
		//Get the logged data
		$.get("collected_data.txt", function(data) {
			var tally_obj = {};
			var tally_arr = [];
			var lines = data.split("\n");
			var total = 0;
			var out = "";

			//Counting frequency of each rapper
			for (var i in lines) {
				var line = lines[i];
				var name_arr = line.match(/^(.+?(?= from))/);
				var name = "";
				if (name_arr != null) { //use null, not undefined check
					//console.log(line);
					//console.log(name_arr[0]);
					name = name_arr[0];
					if (typeof tally_obj[name] == "undefined") {
						tally_obj[name] = 1;
					}
					else {
						tally_obj[name]++;
					}
					total++;
				}
			}

			//Construct and sort an array of name-count pairs
			//Objects look like {"name":"DJ Dog Dick", "count":"666"}
			for (key in tally_obj) {
				obj = {};
				obj["name"] = key;
				obj["count"] = tally_obj[key];
				//console.log(obj);
				tally_arr.push(obj);
			}
			tally_arr.sort(function(x, y) {
				var xc = x["count"];
				var yc = y["count"];
				if (xc < yc) { //descending
					return 1;
				}
				else if (xc == yc) {
					return 0;
				}
				else {
					return -1;
				}
			});

			//Print results
			out += "Total results: " + total + "<br><br>";
			out += to_s(tally_arr, total);
			$("#results").html(out);
			//console.log(tally_obj);


			//D3 visualization
			var height = 900,
				width = 800;
				radius = 300;
			var scale = d3.scale.linear()
				.domain([0, tally_arr[0].count]) //remember it's sorted
				.range([height-100, 0]);

			var chart = d3.select(".chart")
				.attr("height", height)
				.attr("width", width);

			chart.data()





		}); //end ajax
	}

	//
	//t=tally_arr, n=total
	function to_s(t, n) {
		s = "";
		for (var i in t) {
			var name = t[i]["name"];
			var count = t[i]["count"];
			s += name + ": <b>" + count + "</b> (" + ((count/n)*100).toFixed(2) + "%)" + "<br>";
		}
		return s;
	}


	$(window).load(function() {
		tally();
	});




</script>
</body>
</html>